
<HTML><HEAD><TITLE>Manpage of AN_GETHOSTBYNAME</TITLE>
</HEAD><BODY>
<H1>AN_GETHOSTBYNAME</H1>
Section: Antinat Programmer's Manual (3)<BR>Updated: 2005-01-03<BR><A HREF="#index">Index</A>
<A HREF="antinat.3.html">Return to Main Contents</A><HR>

<A NAME="lbAB">&nbsp;</A>
<H2>NAME</H2>

<P>

an_gethostbyname - resolve hostname to address with threadsafety
<A NAME="lbAC">&nbsp;</A>
<H2>SYNOPSIS</H2>

<P>

<B>#include &lt;antinat.h&gt;</B>

<P>
<B>int an_gethostbyname(const char * </B><I>hostname</I><B>, struct hostent * </B><I>destination</I><B>, char * </B><I>buf</I><B>, int </B><I>buf_length</I><B>, struct hostent ** </B><I>ret</I><B>, int * </B><I>thread_errno</I><B>);</B>

<A NAME="lbAD">&nbsp;</A>
<H2>DESCRIPTION</H2>

<P>

The
<B><A HREF="an_gethostbyname.3.html">an_gethostbyname</A></B>(3)

function is a thread-safe, portable replacement for
<B>gethostbyname</B>.

Some platforms have a
<B>gethostbyname_r</B>

function; if this is found,
<B><A HREF="an_gethostbyname.3.html">an_gethostbyname</A></B>(3)

will use it.  Some platforms use thread-local storage for
<B>gethostbyname</B>;

in these cases,
<B><A HREF="an_gethostbyname.3.html">an_gethostbyname</A></B>(3)

will wrap
<B>gethostbyname</B>.

Some platforms don't have any form of thread-safe
<B>gethostbyname</B>;

in which case, it will be implemented using locks.  Beware on platforms
without a built-in threadsafety mechanism: all calls to
<B>gethostbyname</B>

within your application must use this function, or else there is a
possibility of corruption.  This includes calls made from libraries to
which your application links.  If you are using one of these platforms,
please lobby your vendor to support an implementation of
<B>gethostbyname_r</B>.

<P>

The
<B>hostent</B>

structure contains pointers to external data within it.  In order
to implement this without requiring a corresponding deallocation call, memory
is allocated out of the user-supplied 
<I>buf</I>

array.  This array should be at least 1024 bytes in length.  If the function
succeeds, the value of
<I>ret</I>

will point to destination; otherwise, it will be NULL.  Finally, if
determining the reason of an error is required,
<I>thread_errno</I>

contains the errno of the failed
<B>gethostbyname</B>

call; this avoids another thread overwriting an application-wide errno.
<P>

<I>hostname</I>

A null-terminated array that contains the hostname that needs to be resolved
into an IP address.
<P>

<I>destination</I>

is a pointer to the structure that should be filled out with address
information.  This buffer will be used as the primary destination, although
additional memory will be allocated from the user-supplied buffer, as
described above.
<P>

<I>buf</I>

is a pointer to a block of memory.  This should be at least 1024 bytes in
length.  If there is insufficient space in this buffer, the call will fail.
<P>

<I>buf_length</I>

is the number of bytes in the buf parameter, described above.
<P>

<I>ret</I>

is a pointer to a struct hostent *.  This will be modified to point to the
hostent structure being used to store the data if the function succeeds;
otherwise, it will be NULL.  This value is analagous to the return value
from gethostbyname.
<P>

<I>thread_errno</I>

is the value of errno that was generated by the gethostbyname call.  The
exact meaning of this value is platform-dependent.
<A NAME="lbAE">&nbsp;</A>
<H2>NOTES</H2>

<P>

As mentioned previously, be very careful using this function on platforms
that do not have a native
<B>gethostbyname_r</B>

or thread-safe lookups.  You must ensure that all calls to
<B>gethostbyname</B>,

including by libraries, are replaced by calls to this function or you will
have race conditions.  Where it is not possible to replace all instances of
<B>gethostbyname</B>,

you must implement your own locking around all functions that may
potentially cause calls to
<B>gethostbyname</B>,

which will include
<B><A HREF="an_bind_tohostname.3.html">an_bind_tohostname</A></B>(3),

<B><A HREF="an_bind_tosockaddr.3.html">an_bind_tosockaddr</A></B>(3),

<B><A HREF="an_connect_tohostname.3.html">an_connect_tohostname</A></B>(3),<B>and</B>

<B><A HREF="an_connect_tosockaddr.3.html">an_connect_tosockaddr</A></B>(3).

Given the difficulty of determining which functions may call
<B>gethostbyname</B>,

especially as libraries may change, please lobby your vendor to support
<B>gethostbyname_r</B>

or some better method for threadsafety than userspace locks.  Platforms
affected include BSD and Mac OS X.
<A NAME="lbAF">&nbsp;</A>
<H2>RETURN VALUE</H2>

<P>

This call returns
<B>AN_ERROR_SUCCESS</B>

to indicate successful completion.
<A NAME="lbAG">&nbsp;</A>
<H2>ERRORS</H2>

<DL COMPACT>
<DT><B>AN_ERROR_NETWORK</B>

<DD>
Could not resolve the hostname because the system gethostbyname call
failed.  In this case, you should check the thread_errno value for a
better description of the error.
<DT><B>AN_ERROR_NOMEM</B>

<DD>
There was not enough space in the supplied buffer to allocate memory
for all of the required hostent fields.
</DL>
<A NAME="lbAH">&nbsp;</A>
<H2>SEE ALSO</H2>

<P>

<B>gethostbyname</B>,

<B>gethostbyname_r</B>

<A NAME="lbAI">&nbsp;</A>
<H2>AUTHOR</H2>

<P>

Malcolm Smith &lt;<A HREF="mailto:malxau@users.sourceforge.net">malxau@users.sourceforge.net</A>&gt;
<P>

<HR>
<A NAME="index">&nbsp;</A><H2>Index</H2>
<DL>
<DT><A HREF="#lbAB">NAME</A><DD>
<DT><A HREF="#lbAC">SYNOPSIS</A><DD>
<DT><A HREF="#lbAD">DESCRIPTION</A><DD>
<DT><A HREF="#lbAE">NOTES</A><DD>
<DT><A HREF="#lbAF">RETURN VALUE</A><DD>
<DT><A HREF="#lbAG">ERRORS</A><DD>
<DT><A HREF="#lbAH">SEE ALSO</A><DD>
<DT><A HREF="#lbAI">AUTHOR</A><DD>
</DL>
<HR>
Time: 14:19:44 GMT, January 09, 2005
</BODY>
</HTML>
